#!/bin/bash

m4_changequote({{,}})
m4_changecom({{###}})

[ -z "$PS1" ] && return

if [ -z "$TMUX$SSH_CLIENT" ] && command -v tmux > /dev/null &&
			groups "$USER" | tr ' ' '\n' | grep -q '^tmuxers$' &&
			[ -z "$(tmux list-clients)" ]; then
	SHLVL=0 tmux new -A -c ~
fi

m4_include(promptfunc)

stty ixon ixoff ek ixany # 'ek' fixes ctrl+backspace

# Ctrl-Down
bind -x '"\e[1;5B": "cd ..; $PROMPT_COMMAND"'
bind    '"\C-g\C-k": "git commit -m \"\"\e[D"'
bind    '"\C-f": "!! | grep '\'\''\e[D"'
bind -x '"\ec": "history -s $READLINE_LINE"'
bind    '"\\": "|"'

# list files upon completing empty line
complete -Ef

shopt -s histreedit histverify histappend autocd dirspell cdspell globstar checkwinsize
printf 'm4_esyscmd(tabs 4)'

HISTSIZE=2000
HISTCONTROL=ignoredups:ignorespace:erasedups

m4_include(less_termcap)

# disable the "command not found" event if it's slow
unset command_not_found_handle

m4_include(portable_aliases)

if [ -f /usr/local/etc/bashrc ]; then
	. /usr/local/etc/bashrc
fi

if [ -f ~/.bashrc_local ]; then
	. ~/.bashrc_local
fi
